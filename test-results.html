<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Scheduler - Test Results</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .results-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .results-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 13px;
        }

        .results-table tr:hover {
            background-color: #f8f9fa;
        }

        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .status-success {
            color: #27ae60;
            font-weight: bold;
        }

        .status-warning {
            color: #f39c12;
            font-weight: bold;
        }

        .status-danger {
            color: #e74c3c;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }

        .part-analysis {
            margin-top: 20px;
        }

        .part-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .part-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .operation-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ Production Scheduler - Test Results</h1>
            <p>Comprehensive Test with Different Parts, Batches, and Quantities</p>
        </div>

        <div class="card">
            <h2>ðŸ“Š Test Summary</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalOperations">27</div>
                    <div class="stat-label">Total Operations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalParts">5</div>
                    <div class="stat-label">Parts Processed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMachines">7</div>
                    <div class="stat-label">Machines Used</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalConflicts">0</div>
                    <div class="stat-label">Conflicts Found</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ðŸ“‹ Schedule Results</h2>
            <div class="loading" id="loadingResults">
                Loading test results...
            </div>
            <table class="results-table" id="resultsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Part Number</th>
                        <th>Order Qty</th>
                        <th>Priority</th>
                        <th>Batch ID</th>
                        <th>Batch Qty</th>
                        <th>Op Seq</th>
                        <th>Operation Name</th>
                        <th>Machine</th>
                        <th>Person</th>
                        <th>Setup Start</th>
                        <th>Setup End</th>
                        <th>Run Start</th>
                        <th>Run End</th>
                        <th>Timing</th>
                        <th>Due Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>ðŸŽ¯ Part Analysis</h2>
            <div id="partAnalysis">
                <div class="loading">Loading part analysis...</div>
            </div>
        </div>

        <div class="card">
            <h2>ðŸ”§ Resource Utilization</h2>
            <div id="resourceUtilization">
                <div class="loading">Loading resource utilization...</div>
            </div>
        </div>

        <div class="card">
            <h2>ðŸ“¦ Batch Splitting Analysis</h2>
            <div id="batchAnalysis">
                <div class="loading">Loading batch analysis...</div>
            </div>
        </div>
    </div>

    <!-- Load the scheduling engine -->
    <script src="x10-browser.js?v=1.0"></script>
    
    <script>
        // Test data
        const testOrders = [
            {
                partNumber: 'PN2001',
                quantity: 150,
                priority: 'High',
                dueDate: '2025-09-02',
                startDateTime: '2025-09-01 06:00'
            },
            {
                partNumber: 'PN3001',
                quantity: 400,
                priority: 'Normal',
                dueDate: '2025-09-03',
                startDateTime: '2025-09-01 06:00'
            },
            {
                partNumber: 'PN4001',
                quantity: 800,
                priority: 'Low',
                dueDate: '2025-09-05',
                startDateTime: '2025-09-01 06:00'
            },
            {
                partNumber: 'PN5001',
                quantity: 50,
                priority: 'Urgent',
                dueDate: '2025-09-01',
                startDateTime: '2025-09-01 06:00'
            },
            {
                partNumber: 'PN6001',
                quantity: 1200,
                priority: 'Normal',
                dueDate: '2025-09-07',
                startDateTime: '2025-09-01 06:00'
            }
        ];

        const testOperations = [
            // PN2001 operations (2 operations)
            {
                PartNumber: 'PN2001',
                OperationSeq: 1,
                OperationName: 'Turning',
                SetupTime_Min: 60,
                CycleTime_Min: 12,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2', 'VMC 3'],
                Operator: 1
            },
            {
                PartNumber: 'PN2001',
                OperationSeq: 2,
                OperationName: 'Milling',
                SetupTime_Min: 80,
                CycleTime_Min: 8,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 4', 'VMC 5'],
                Operator: 1
            },
            
            // PN3001 operations (3 operations)
            {
                PartNumber: 'PN3001',
                OperationSeq: 1,
                OperationName: 'Facing',
                SetupTime_Min: 90,
                CycleTime_Min: 15,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2', 'VMC 3', 'VMC 4'],
                Operator: 1
            },
            {
                PartNumber: 'PN3001',
                OperationSeq: 2,
                OperationName: 'Boring',
                SetupTime_Min: 70,
                CycleTime_Min: 10,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 5', 'VMC 6', 'VMC 7'],
                Operator: 1
            },
            {
                PartNumber: 'PN3001',
                OperationSeq: 3,
                OperationName: 'Threading',
                SetupTime_Min: 50,
                CycleTime_Min: 5,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2'],
                Operator: 1
            },
            
            // PN4001 operations (4 operations)
            {
                PartNumber: 'PN4001',
                OperationSeq: 1,
                OperationName: 'Roughing',
                SetupTime_Min: 120,
                CycleTime_Min: 20,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2'],
                Operator: 1
            },
            {
                PartNumber: 'PN4001',
                OperationSeq: 2,
                OperationName: 'Finishing',
                SetupTime_Min: 100,
                CycleTime_Min: 15,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 3', 'VMC 4'],
                Operator: 1
            },
            {
                PartNumber: 'PN4001',
                OperationSeq: 3,
                OperationName: 'Threading',
                SetupTime_Min: 60,
                CycleTime_Min: 8,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 5', 'VMC 6'],
                Operator: 1
            },
            {
                PartNumber: 'PN4001',
                OperationSeq: 4,
                OperationName: 'Inspection',
                SetupTime_Min: 30,
                CycleTime_Min: 3,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 7'],
                Operator: 1
            },
            
            // PN5001 operations (1 operation - simple)
            {
                PartNumber: 'PN5001',
                OperationSeq: 1,
                OperationName: 'Simple',
                SetupTime_Min: 45,
                CycleTime_Min: 6,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2', 'VMC 3', 'VMC 4', 'VMC 5', 'VMC 6', 'VMC 7'],
                Operator: 1
            },
            
            // PN6001 operations (5 operations - complex)
            {
                PartNumber: 'PN6001',
                OperationSeq: 1,
                OperationName: 'Roughing',
                SetupTime_Min: 150,
                CycleTime_Min: 25,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2'],
                Operator: 1
            },
            {
                PartNumber: 'PN6001',
                OperationSeq: 2,
                OperationName: 'Semi-Finishing',
                SetupTime_Min: 120,
                CycleTime_Min: 18,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 3', 'VMC 4'],
                Operator: 1
            },
            {
                PartNumber: 'PN6001',
                OperationSeq: 3,
                OperationName: 'Finishing',
                SetupTime_Min: 100,
                CycleTime_Min: 12,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 5', 'VMC 6'],
                Operator: 1
            },
            {
                PartNumber: 'PN6001',
                OperationSeq: 4,
                OperationName: 'Threading',
                SetupTime_Min: 80,
                CycleTime_Min: 8,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 7'],
                Operator: 1
            },
            {
                PartNumber: 'PN6001',
                OperationSeq: 5,
                OperationName: 'Final Inspection',
                SetupTime_Min: 40,
                CycleTime_Min: 4,
                Minimum_BatchSize: 1,
                EligibleMachines: ['VMC 1', 'VMC 2'],
                Operator: 1
            }
        ];

        // Run the test when page loads
        window.addEventListener('load', function() {
            console.log('ðŸŽ¯ Starting comprehensive test...');
            
            try {
                const result = runSchedulingInBrowser(testOrders, testOperations);
                
                if (result.success) {
                    console.log('âœ… Test executed successfully');
                    displayResults(result.outputData.mainOutput);
                } else {
                    console.log('âŒ Test failed');
                    document.getElementById('loadingResults').innerHTML = 'âŒ Test failed';
                }
            } catch (error) {
                console.error('âŒ Error:', error);
                document.getElementById('loadingResults').innerHTML = 'âŒ Error: ' + error.message;
            }
        });

        function displayResults(results) {
            // Hide loading and show table
            document.getElementById('loadingResults').style.display = 'none';
            document.getElementById('resultsTable').style.display = 'table';
            
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';
            
            results.forEach(row => {
                const [partNumber, orderQty, priority, batchId, batchQty, opSeq, opName, machine, person, setupStart, setupEnd, runStart, runEnd, timing, dueDate] = row;
                
                const tr = document.createElement('tr');
                
                // Check if due date is met
                const runEndDate = new Date(runEnd);
                const dueDateObj = new Date(dueDate);
                const isOnTime = runEndDate <= dueDateObj;
                const statusClass = isOnTime ? 'status-success' : 'status-warning';
                const statusText = isOnTime ? 'âœ…' : 'âš ï¸';
                
                tr.innerHTML = `
                    <td>${partNumber}</td>
                    <td>${orderQty}</td>
                    <td>${priority}</td>
                    <td>${batchId}</td>
                    <td>${batchQty}</td>
                    <td>${opSeq}</td>
                    <td>${opName}</td>
                    <td>${machine}</td>
                    <td>${person}</td>
                    <td>${setupStart}</td>
                    <td>${setupEnd}</td>
                    <td>${runStart}</td>
                    <td>${runEnd}</td>
                    <td>${timing}</td>
                    <td>${dueDate}</td>
                    <td class="${statusClass}">${statusText}</td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Display part analysis
            displayPartAnalysis(results);
            
            // Display resource utilization
            displayResourceUtilization(results);
            
            // Display batch analysis
            displayBatchAnalysis(results);
        }

        function displayPartAnalysis(results) {
            const partAnalysisDiv = document.getElementById('partAnalysis');
            partAnalysisDiv.innerHTML = '';
            
            // Group by part number
            const parts = {};
            results.forEach(row => {
                const partNumber = row[0];
                if (!parts[partNumber]) {
                    parts[partNumber] = [];
                }
                parts[partNumber].push(row);
            });
            
            Object.keys(parts).forEach(partNumber => {
                const operations = parts[partNumber];
                const orderQty = operations[0][1];
                const priority = operations[0][2];
                const totalOps = operations.length;
                
                const partCard = document.createElement('div');
                partCard.className = 'part-card';
                
                const firstOp = operations[0];
                const lastOp = operations[operations.length - 1];
                const startTime = new Date(firstOp[9]); // SetupStart
                const endTime = new Date(lastOp[12]); // RunEnd
                const totalTime = Math.round((endTime - startTime) / (60 * 1000)); // minutes
                const totalDays = Math.floor(totalTime / 1440);
                const totalHours = Math.floor((totalTime % 1440) / 60);
                const totalMinutes = totalTime % 60;
                
                let operationsHtml = '';
                operations.forEach(row => {
                    const [partNumber, orderQty, priority, batchId, batchQty, opSeq, opName, machine, person, setupStart, setupEnd, runStart, runEnd, timing, dueDate] = row;
                    operationsHtml += `
                        <div class="operation-item">
                            <strong>Op${opSeq} (${opName}):</strong> ${machine} ${person} | 
                            Setup ${setupStart}â†’${setupEnd} | 
                            Run ${runStart}â†’${runEnd} | 
                            <strong>${timing}</strong>
                        </div>
                    `;
                });
                
                partCard.innerHTML = `
                    <div class="part-header">ðŸ“Š ${partNumber} (${orderQty} pieces, ${priority} priority)</div>
                    <div><strong>Operations:</strong> ${totalOps}</div>
                    <div><strong>Total Time:</strong> ${totalDays}D ${totalHours}H ${totalMinutes}M</div>
                    <div><strong>Start:</strong> ${firstOp[9]} | <strong>End:</strong> ${lastOp[12]}</div>
                    <div class="part-analysis">
                        ${operationsHtml}
                    </div>
                `;
                
                partAnalysisDiv.appendChild(partCard);
            });
        }

        function displayResourceUtilization(results) {
            const resourceDiv = document.getElementById('resourceUtilization');
            resourceDiv.innerHTML = '';
            
            const machineUsage = {};
            const operatorUsage = {};
            
            results.forEach(row => {
                const [partNumber, orderQty, priority, batchId, batchQty, opSeq, opName, machine, person, setupStart, setupEnd, runStart, runEnd, timing, dueDate] = row;
                
                if (!machineUsage[machine]) {
                    machineUsage[machine] = [];
                }
                machineUsage[machine].push({
                    partNumber,
                    batchId,
                    opSeq,
                    opName
                });
                
                if (!operatorUsage[person]) {
                    operatorUsage[person] = [];
                }
                operatorUsage[person].push({
                    partNumber,
                    batchId,
                    opSeq,
                    opName
                });
            });
            
            let machineHtml = '<h3>Machine Usage:</h3>';
            Object.keys(machineUsage).forEach(machine => {
                const operations = machineUsage[machine];
                machineHtml += `<div class="part-card"><strong>${machine}:</strong> ${operations.length} operations<br>`;
                operations.forEach(op => {
                    machineHtml += `&nbsp;&nbsp;${op.partNumber}-${op.batchId}-Op${op.opSeq} (${op.opName})<br>`;
                });
                machineHtml += '</div>';
            });
            
            let operatorHtml = '<h3>Operator Usage:</h3>';
            Object.keys(operatorUsage).forEach(operator => {
                const operations = operatorUsage[operator];
                operatorHtml += `<div class="part-card"><strong>${operator}:</strong> ${operations.length} setups<br>`;
                operations.forEach(op => {
                    operatorHtml += `&nbsp;&nbsp;${op.partNumber}-${op.batchId}-Op${op.opSeq} (${op.opName})<br>`;
                });
                operatorHtml += '</div>';
            });
            
            resourceDiv.innerHTML = machineHtml + operatorHtml;
        }

        function displayBatchAnalysis(results) {
            const batchDiv = document.getElementById('batchAnalysis');
            batchDiv.innerHTML = '';
            
            // Group by part number
            const parts = {};
            results.forEach(row => {
                const partNumber = row[0];
                if (!parts[partNumber]) {
                    parts[partNumber] = [];
                }
                parts[partNumber].push(row);
            });
            
            let batchHtml = '';
            Object.keys(parts).forEach(partNumber => {
                const operations = parts[partNumber];
                const batches = {};
                operations.forEach(row => {
                    const batchId = row[3];
                    if (!batches[batchId]) {
                        batches[batchId] = [];
                    }
                    batches[batchId].push(row);
                });
                
                if (Object.keys(batches).length > 1) {
                    batchHtml += `<div class="part-card"><strong>${partNumber}:</strong> Split into ${Object.keys(batches).length} batches<br>`;
                    Object.keys(batches).forEach(batchId => {
                        const batchOps = batches[batchId];
                        const batchQty = batchOps[0][4];
                        batchHtml += `&nbsp;&nbsp;${batchId}: ${batchQty} pieces, ${batchOps.length} operations<br>`;
                    });
                    batchHtml += '</div>';
                } else {
                    batchHtml += `<div class="part-card"><strong>${partNumber}:</strong> Single batch (${operations[0][4]} pieces)</div>`;
                }
            });
            
            batchDiv.innerHTML = batchHtml;
        }
    </script>
</body>
</html>
