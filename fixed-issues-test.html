<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Scheduler - Fixed Issues Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .info {
            color: #3498db;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Production Scheduler - Fixed Issues Test</h1>
            <p>Testing the fixes for UI and Backend integration issues</p>
        </div>

        <div class="test-section">
            <h3>üîß Issue Fixes Applied:</h3>
            <ul>
                <li>‚úÖ <strong>Part Number Display:</strong> Fixed data mapping to show actual part numbers instead of machine lists</li>
                <li>‚úÖ <strong>Operation Sequence:</strong> Fixed OperationSeq default from 0 to 1</li>
                <li>‚úÖ <strong>Operator Assignment:</strong> Fixed batch ID format (B01, B02) for proper operator assignment</li>
                <li>‚úÖ <strong>Missing x10.js:</strong> Fixed script reference to use x10-browser.js</li>
                <li>‚úÖ <strong>Data Structure:</strong> Fixed order data format for scheduling engine</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üß™ Test Scheduling Engine:</h3>
            <button class="btn" onclick="testBasicScheduling()">Test Basic Scheduling</button>
            <button class="btn" onclick="testMultiOperation()">Test Multi-Operation</button>
            <button class="btn" onclick="testBatchSplitting()">Test Batch Splitting</button>
            <div id="testResults" class="results" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üìä Expected Results:</h3>
            <ul>
                <li><strong>Part Number:</strong> Should show actual part number (e.g., "PN1001")</li>
                <li><strong>Operation Seq:</strong> Should show proper sequence (e.g., "1", "2", "3")</li>
                <li><strong>Person:</strong> Should show operator (e.g., "A", "B", "C", "D")</li>
                <li><strong>Batch ID:</strong> Should show proper format (e.g., "B01", "B02")</li>
                <li><strong>Machine:</strong> Should show assigned machine (e.g., "VMC 1")</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üöÄ How to Test:</h3>
            <ol>
                <li>Click the test buttons above to verify the engine works</li>
                <li>Go back to the main application</li>
                <li>Add a new order with a valid part number</li>
                <li>Run the schedule</li>
                <li>Verify the results show correct part numbers, operation sequences, and operators</li>
            </ol>
        </div>
    </div>

    <!-- Load the scheduling engine -->
    <script src="x10-browser.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML += `<div class="${type}">${message}</div>`;
        }

        function testBasicScheduling() {
            document.getElementById('testResults').innerHTML = '';
            log('üß™ Testing Basic Scheduling...', 'info');
            
            try {
                const testOrder = {
                    partNumber: 'TEST001',
                    quantity: 100,
                    priority: 'Normal',
                    dueDate: '2025-09-02',
                    startDateTime: '2025-09-01 06:00'
                };
                
                const testOperations = [{
                    PartNumber: 'TEST001',
                    OperationSeq: 1,
                    OperationName: 'Test Operation',
                    SetupTime_Min: 60,
                    CycleTime_Min: 5,
                    Minimum_BatchSize: 1,
                    EligibleMachines: ['VMC 1'],
                    Operator: 1
                }];
                
                const result = runSchedulingInBrowser([testOrder], testOperations);
                
                if (result.success) {
                    log('‚úÖ Basic scheduling test PASSED', 'success');
                    log(`   Operations scheduled: ${result.outputData.mainOutput.length}`, 'info');
                    log(`   Part Number: ${result.outputData.mainOutput[0][0]}`, 'info');
                    log(`   Operation Seq: ${result.outputData.mainOutput[0][5]}`, 'info');
                    log(`   Person: ${result.outputData.mainOutput[0][8]}`, 'info');
                    log(`   Machine: ${result.outputData.mainOutput[0][7]}`, 'info');
                } else {
                    log('‚ùå Basic scheduling test FAILED', 'error');
                }
            } catch (error) {
                log(`‚ùå Test error: ${error.message}`, 'error');
            }
        }

        function testMultiOperation() {
            log('üß™ Testing Multi-Operation Scheduling...', 'info');
            
            try {
                const testOrder = {
                    partNumber: 'TEST002',
                    quantity: 50,
                    priority: 'Normal',
                    dueDate: '2025-09-02',
                    startDateTime: '2025-09-01 06:00'
                };
                
                const testOperations = [
                    {
                        PartNumber: 'TEST002',
                        OperationSeq: 1,
                        OperationName: 'Op1',
                        SetupTime_Min: 70,
                        CycleTime_Min: 18,
                        Minimum_BatchSize: 1,
                        EligibleMachines: ['VMC 1'],
                        Operator: 1
                    },
                    {
                        PartNumber: 'TEST002',
                        OperationSeq: 2,
                        OperationName: 'Op2',
                        SetupTime_Min: 70,
                        CycleTime_Min: 10,
                        Minimum_BatchSize: 1,
                        EligibleMachines: ['VMC 2'],
                        Operator: 1
                    }
                ];
                
                const result = runSchedulingInBrowser([testOrder], testOperations);
                
                if (result.success) {
                    log('‚úÖ Multi-operation test PASSED', 'success');
                    log(`   Operations scheduled: ${result.outputData.mainOutput.length}`, 'info');
                    result.outputData.mainOutput.forEach((row, idx) => {
                        log(`   Op${idx + 1}: ${row[0]} | Seq: ${row[5]} | Person: ${row[8]} | Machine: ${row[7]}`, 'info');
                    });
                } else {
                    log('‚ùå Multi-operation test FAILED', 'error');
                }
            } catch (error) {
                log(`‚ùå Test error: ${error.message}`, 'error');
            }
        }

        function testBatchSplitting() {
            log('üß™ Testing Batch Splitting...', 'info');
            
            try {
                const testOrder = {
                    partNumber: 'TEST003',
                    quantity: 500,
                    priority: 'Normal',
                    dueDate: '2025-09-02',
                    startDateTime: '2025-09-01 06:00'
                };
                
                const testOperations = [{
                    PartNumber: 'TEST003',
                    OperationSeq: 1,
                    OperationName: 'Test Operation',
                    SetupTime_Min: 60,
                    CycleTime_Min: 5,
                    Minimum_BatchSize: 1,
                    EligibleMachines: ['VMC 1'],
                    Operator: 1
                }];
                
                const result = runSchedulingInBrowser([testOrder], testOperations);
                
                if (result.success) {
                    log('‚úÖ Batch splitting test PASSED', 'success');
                    log(`   Operations scheduled: ${result.outputData.mainOutput.length}`, 'info');
                    result.outputData.mainOutput.forEach((row, idx) => {
                        log(`   Batch${idx + 1}: ${row[3]} | Qty: ${row[4]} | Person: ${row[8]}`, 'info');
                    });
                } else {
                    log('‚ùå Batch splitting test FAILED', 'error');
                }
            } catch (error) {
                log(`‚ùå Test error: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.addEventListener('load', function() {
            log('üéØ Test page loaded successfully!', 'success');
            log('Click the test buttons above to verify the fixes work.', 'info');
        });
    </script>
</body>
</html>
